import{c as g,u as k,r as i,s as f,j as e,U as d,i as U,X as A}from"./index-DgQnJBRP.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=g("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h=g("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),S=()=>{var u;const{user:r}=k(),[n,x]=i.useState([]),[y,j]=i.useState(!0),[c,v]=i.useState("all");i.useEffect(()=>{var s;((s=r==null?void 0:r.user_metadata)==null?void 0:s.ruolo)==="owner"&&b()},[r]);const b=async()=>{try{const{data:s,error:t}=await f.from("users").select("*").order("created_at",{ascending:!1});if(t){console.error("Error fetching users:",t);return}const a=s.map(l=>({...l,status:l.approved?"approved":"pending"}));x(a)}catch(s){console.error("Error fetching users:",s)}finally{j(!1)}},m=async(s,t)=>{try{const{error:a}=await f.from("users").update({approved:t}).eq("id",s);if(a){console.error("Error updating user approval:",a);return}x(l=>l.map(o=>o.id===s?{...o,approved:t,status:t?"approved":"pending"}:o))}catch(a){console.error("Error updating user approval:",a)}},p=n.filter(s=>c==="all"?!0:s.status===c),N=(s,t)=>s==="approved"||t?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Approvato"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"In attesa"]}),w=s=>{const t={owner:"bg-purple-100 text-purple-800",manager:"bg-blue-100 text-blue-800",commerciale:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t[s]||t.commerciale}`,children:s.charAt(0).toUpperCase()+s.slice(1)})};return((u=r==null?void 0:r.user_metadata)==null?void 0:u.ruolo)!=="owner"?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Accesso non autorizzato. Solo gli owner possono gestire gli utenti."})]})}):y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(d,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestione Utenti"}),e.jsx("p",{className:"text-gray-600",children:"Approva o gestisci gli account degli utenti"})]})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"all",label:"Tutti",count:n.length},{key:"pending",label:"In attesa",count:n.filter(s=>!s.approved).length},{key:"approved",label:"Approvati",count:n.filter(s=>s.approved).length}].map(s=>e.jsxs("button",{onClick:()=>v(s.key),className:`py-2 px-1 border-b-2 font-medium text-sm ${c===s.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.label,e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-900 py-0.5 px-2.5 rounded-full text-xs",children:s.count})]},s.key))})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e.jsx("ul",{className:"divide-y divide-gray-200",children:p.map(s=>e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(d,{className:"h-5 w-5 text-gray-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:[s.nome," ",s.cognome]}),w(s.ruolo),N(s.status,s.approved)]}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Registrato il ",new Date(s.created_at).toLocaleDateString("it-IT")]})]})]}),s.ruolo!=="owner"&&e.jsx("div",{className:"flex items-center space-x-2",children:s.approved?e.jsxs("button",{onClick:()=>m(s.id,!1),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Revoca"]}):e.jsxs("button",{onClick:()=>m(s.id,!0),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Approva"]})})]})},s.id))}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nessun utente trovato per il filtro selezionato."})]})]})]})};export{S as default};
