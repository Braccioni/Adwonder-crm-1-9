import{r as s,j as e,X as T,C as N}from"./index-DgQnJBRP.js";import{a as g}from"./activityService-GB8zn4EP.js";import{c as z}from"./clientService-DOg-DVUb.js";import{d as F}from"./dealService-BGrHSSP5.js";import{P,S as M,a as L,T as q}from"./trash-2-ZARSRhba.js";import{M as I,P as O}from"./phone-DgSdS8d9.js";import{f as R,i as H}from"./it-Byu6YFuj.js";import"./cacheManager-C0Kc18OK.js";const U=({activity:l,onSubmit:p,onClose:u})=>{const[f,v]=s.useState([]),[h,b]=s.useState([]),[i,m]=s.useState({tipo_attivita:"call",data_ora:new Date().toISOString().slice(0,16),esito:"positiva",client_id:"",deal_id:"",note:""});s.useEffect(()=>{x()},[]),s.useEffect(()=>{l&&m({tipo_attivita:l.tipo_attivita,data_ora:l.data_ora.slice(0,16),esito:l.esito,client_id:l.client_id||"",deal_id:l.deal_id||"",note:l.note||""})},[l]);const x=async()=>{try{const[a,n]=await Promise.all([z.getAll(),F.getAll()]);v(a),b(n)}catch(a){console.error("Error loading data:",a)}},o=a=>{a.preventDefault();const n={...i,data_ora:new Date(i.data_ora).toISOString(),client_id:i.client_id||void 0,deal_id:i.deal_id||void 0};p(n)},c=a=>{const{name:n,value:d}=a.target;m(j=>({...j,[n]:d}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:l?"Modifica Attività":"Nuova Attività"}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(T,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo Attività *"}),e.jsxs("select",{name:"tipo_attivita",value:i.tipo_attivita,onChange:c,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"call",children:"Chiamata"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"meeting",children:"Meeting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data e Ora *"}),e.jsx("input",{type:"datetime-local",name:"data_ora",value:i.data_ora,onChange:c,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Esito *"}),e.jsxs("select",{name:"esito",value:i.esito,onChange:c,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"positiva",children:"Positiva"}),e.jsx("option",{value:"da_richiamare",children:"Da Richiamare"}),e.jsx("option",{value:"nessuna_risposta",children:"Nessuna Risposta"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente"}),e.jsxs("select",{name:"client_id",value:i.client_id,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Seleziona un cliente"}),f.map(a=>e.jsxs("option",{value:a.id,children:[a.nome_azienda," - ",a.referente_principale]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trattativa"}),e.jsxs("select",{name:"deal_id",value:i.deal_id,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Seleziona una trattativa"}),h.map(a=>{var n;return e.jsxs("option",{value:a.id,children:[a.oggetto_trattativa," - ",(n=a.client)==null?void 0:n.nome_azienda]},a.id)})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note"}),e.jsx("textarea",{name:"note",value:i.note,onChange:c,rows:4,placeholder:"Aggiungi dettagli sull'attività...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Annulla"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors",children:[l?"Aggiorna":"Crea"," Attività"]})]})]})]})})},W=()=>{const[l,p]=s.useState([]),[u,f]=s.useState([]),[v,h]=s.useState(!0),[b,i]=s.useState(!1),[m,x]=s.useState(),[o,c]=s.useState(""),[a,n]=s.useState("all"),[d,j]=s.useState("all");s.useEffect(()=>{y()},[]);const w=s.useCallback(()=>{let t=l;o&&(t=t.filter(r=>{var _;return r.note&&r.note.toLowerCase().includes(o.toLowerCase())||((_=r.client)==null?void 0:_.nome_azienda.toLowerCase().includes(o.toLowerCase()))})),a!=="all"&&(t=t.filter(r=>r.tipo_attivita===a)),d!=="all"&&(t=t.filter(r=>r.esito===d)),f(t)},[l,o,a,d]);s.useEffect(()=>{w()},[w]);const y=async()=>{try{h(!0);const t=await g.getAll();p(t)}catch(t){console.error("Error loading activities:",t)}finally{h(!1)}},C=async t=>{try{m?await g.update(m.id,t):await g.create(t),await y(),i(!1),x(void 0)}catch(r){console.error("Error saving activity:",r)}},S=t=>{x(t),i(!0)},A=async t=>{if(window.confirm("Sei sicuro di voler eliminare questa attività?"))try{await g.delete(t),await y()}catch(r){console.error("Error deleting activity:",r)}},D=t=>{switch(t){case"call":return O;case"email":return I;case"meeting":return N;default:return N}},E=t=>{switch(t){case"positiva":return"bg-green-100 text-green-800";case"da_richiamare":return"bg-yellow-100 text-yellow-800";case"nessuna_risposta":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},k=t=>R(new Date(t),"dd/MM/yyyy HH:mm",{locale:H});return v?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((t,r)=>e.jsx("div",{className:"bg-gray-200 h-16 rounded-lg"},r))})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Attività"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Traccia tutte le tue attività commerciali"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"Nuova Attività"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Cerca attività...",value:o,onChange:t=>c(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:a,onChange:t=>n(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tutti i tipi"}),e.jsx("option",{value:"call",children:"Chiamata"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"meeting",children:"Meeting"})]}),e.jsxs("select",{value:d,onChange:t=>j(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tutti gli esiti"}),e.jsx("option",{value:"positiva",children:"Positiva"}),e.jsx("option",{value:"da_richiamare",children:"Da Richiamare"}),e.jsx("option",{value:"nessuna_risposta",children:"Nessuna Risposta"})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[u.length," di ",l.length," attività"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:u.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:u.map(t=>{const r=D(t.tipo_attivita);return e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(r,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 capitalize",children:t.tipo_attivita}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${E(t.esito)}`,children:t.esito.replace("_"," ").toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-500",children:k(t.data_ora)})]}),e.jsxs("div",{className:"space-y-1",children:[t.client&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Cliente: ",e.jsx("span",{className:"font-medium",children:t.client.nome_azienda})]}),t.deal&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Trattativa: ",e.jsx("span",{className:"font-medium",children:t.deal.oggetto_trattativa})]}),t.note&&e.jsx("p",{className:"text-sm text-gray-700 mt-2",children:t.note})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>S(t),className:"text-blue-600 hover:text-blue-900 transition-colors",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(t.id),className:"text-red-600 hover:text-red-900 transition-colors",children:e.jsx(q,{className:"w-4 h-4"})})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Nessuna attività trovata"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:o||a!=="all"||d!=="all"?"Prova a modificare i filtri di ricerca":"Inizia aggiungendo una nuova attività"})]})}),b&&e.jsx(U,{activity:m,onSubmit:C,onClose:()=>{i(!1),x(void 0)}})]})};export{W as default};
